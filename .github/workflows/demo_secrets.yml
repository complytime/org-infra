name: Demo Secrets
on: [workflow_dispatch]

jobs:
  demo:
    runs-on: ubuntu-latest
    env:
      SOPS_AGE_KEY: ${{ secrets.SOPS_AGE_KEY }}
    steps:
      - uses: actions/checkout@v3

      - name: Install Sops
        run: |
          curl -LO https://github.com/getsops/sops/releases/download/v3.9.4/sops-v3.9.4.linux.amd64
          mv sops-v3.9.4.linux.amd64 /usr/local/bin/sops
          chmod +x /usr/local/bin/sops

      - name: Decrypt Secrets
        run: |
          sops -d secrets.enc.yaml > secrets.yaml

      - name: Verify Decryption
        run: |
          if grep -q "my_secret" secrets.yaml; then
            echo "Secrets decrypted successfully!"
          else
            echo "Failed to decrypt."
            exit 1
          fi
